<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <script src="jquery.star-rating-svg.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">

  <title>Document</title>
</head>

<body>
  <h1>Start</h1>
  <div id="cardBodyContainer"></div>
  <h1>End</h1>

  <script id="productListingTemplate" type="text/x-handlebars-template">
    {{#each products}}
      <div>
        <h3><b>NAME OF PRODUCT:- </b>{{name}}</h3>
        <p><b>PRICE :- </b>{{price}}</p>
        <P><b>SELLING PRCE :- </b>{{selling_price}}</P>
        <p><b>DISCOUNT :- </b>{{Discount price selling_price}}</p>

        {{#each reviews}}
          <div>
            <p><b>AUTHOR :- </b>{{author}}</p>
            <p><b>RATING :- </b>{{rating}}</p>
            <div class="my-rating"></div>
            <p><b>COMMENT :- </b>{{comment}}</p>
          </div>
        {{/each}}

        <button>Add to card button </button>

      </div>
    {{/each}}
  </script>

  <script src="./handlebars.min-v4.7.7.js"></script>
  <script>
    Handlebars.registerHelper("Discount", function (price, selling_price) {
      var Discount = ((price - selling_price) / price) * 100;
      return Discount.toFixed(0) + "%" + "off";
    });

    Handlebars.registerHelper("starrating", function (rating) {
    
      var starRating = $("<div>").addClass("my-rating");
      starRating.starRating({
        starSize: 20,
        totalStars: 5,
        initialRating: rating,
        useFullStars: true,
        readOnly: true
      });
      return starRating.prop("outerHTML");
    });

    async function logJSONData() {
      const response = await fetch("./data.json");
      const jsonData = await response.json();
      if (jsonData) {
        const rawTempalte = document.getElementById(
          "productListingTemplate"
        ).innerHTML;

        const compiledProductListingTempalte = Handlebars.compile(rawTempalte);

        const ourGeneratedTempalte = compiledProductListingTempalte(jsonData);

        const productListingContainer =
          document.getElementById("cardBodyContainer");

        productListingContainer.innerHTML = ourGeneratedTempalte;
      }
    }

    logJSONData().then(() => {
    
      $(".my-rating").starRating({
        starSize: 20,
        totalStars: 5,
        useFullStars: true,
        readOnly: true
      });
    });
  </script>
</body>

